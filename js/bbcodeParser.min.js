var bbcodeParser={};(function(){var token_match=/{[A-Z_]+[0-9]*}/g;bbcodeParser.tokens={'URL':'((?:(?:[a-z][a-z\\d+\\-.]*:\\/{2}(?:(?:[a-z0-9\\-._~\\!$&\'*+,;=:@|]+|%[\\dA-F]{2})+|[0-9.]+|\\[[a-z0-9.]+:[a-z0-9.]+:[a-z0-9.:]+\\])(?::\\d*)?(?:\\/(?:[a-z0-9\\-._~\\!$&\'*+,;=:@|]+|%[\\dA-F]{2})*)*(?:\\?(?:[a-z0-9\\-._~\\!$&\'*+,;=:@\\/?|]+|%[\\dA-F]{2})*)?(?:#(?:[a-z0-9\\-._~\\!$&\'*+,;=:@\\/?|]+|%[\\dA-F]{2})*)?)|(?:www\\.(?:[a-z0-9\\-._~\\!$&\'*+,;=:@|]+|%[\\dA-F]{2})+(?::\\d*)?(?:\\/(?:[a-z0-9\\-._~\\!$&\'*+,;=:@|]+|%[\\dA-F]{2})*)*(?:\\?(?:[a-z0-9\\-._~\\!$&\'*+,;=:@\\/?|]+|%[\\dA-F]{2})*)?(?:#(?:[a-z0-9\\-._~\\!$&\'*+,;=:@\\/?|]+|%[\\dA-F]{2})*)?)))','LOCAL_URL':'((?:[a-z0-9\-._~\!$&\'()*+,;=:@|]+|%[\dA-F]{2})*(?:\/(?:[a-z0-9\-._~\!$&\'()*+,;=:@|]+|%[\dA-F]{2})*)*(?:\?(?:[a-z0-9\-._~\!$&\'()*+,;=:@\/?|]+|%[\dA-F]{2})*)?(?:#(?:[a-z0-9\-._~\!$&\'()*+,;=:@\/?|]+|%[\dA-F]{2})*)?)','EMAIL':'((?:[\\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+\.)*(?:[\\w\!\#$\%\'\*\+\-\/\=\?\^\`{\|\}\~]|&)+@(?:(?:(?:(?:(?:[a-z0-9]{1}[a-z0-9\-]{0,62}[a-z0-9]{1})|[a-z])\.)+[a-z]{2,6})|(?:\\d{1,3}\.){3}\\d{1,3}(?:\:\\d{1,5})?))','TEXT':'(.*?)','SIMPLETEXT':'([a-zA-Z0-9-+.,_ ]+)','INTTEXT':'([a-zA-Z0-9-+,_. ]+)','IDENTIFIER':'([a-zA-Z0-9-_]+)','COLOR':'([a-z]+|#[0-9abcdef]+)','NUMBER':'([0-9]+)'};bbcodeParser.bbcode_matches=[];bbcodeParser.html_tpls=[];bbcodeParser.html_matches=[];bbcodeParser.bbcode_tpls=[];bbcodeParser._getRegEx=function(str){var matches=str.match(token_match);var i=0;var replacement='';if(matches.length<=0){return new RegExp(preg_quote(str),'g');}
for(;i<matches.length;i+=1){var token=matches[i].replace(/[{}0-9]/g,'');if(bbcodeParser.tokens[token]){replacement+=preg_quote(str.substr(0,str.indexOf(matches[i])))+bbcodeParser.tokens[token];str=str.substr(str.indexOf(matches[i])+matches[i].length);}}
replacement+=preg_quote(str);return new RegExp(replacement,'gi');};bbcodeParser._getTpls=function(str){var matches=str.match(token_match);var i=0;var replacement='';var positions={};var next_position=0;if(matches.length<=0){return str;}
for(;i<matches.length;i+=1){var token=matches[i].replace(/[{}0-9]/g,'');var position;if(positions[matches[i]]){position=positions[matches[i]];}else{next_position+=1;position=next_position;positions[matches[i]]=position;}
if(bbcodeParser.tokens[token]){replacement+=str.substr(0,str.indexOf(matches[i]))+'$'+position;str=str.substr(str.indexOf(matches[i])+matches[i].length);}}
replacement+=str;return replacement;};bbcodeParser.addBBCode=function(bbcode_match,bbcode_tpl){bbcodeParser.bbcode_matches.push(bbcodeParser._getRegEx(bbcode_match));bbcodeParser.html_tpls.push(bbcodeParser._getTpls(bbcode_tpl));bbcodeParser.html_matches.push(bbcodeParser._getRegEx(bbcode_tpl));bbcodeParser.bbcode_tpls.push(bbcodeParser._getTpls(bbcode_match));};bbcodeParser.bbcodeToHtml=function(str){var i=0;for(;i<bbcodeParser.bbcode_matches.length;i+=1){str=str.replace(bbcodeParser.bbcode_matches[i],bbcodeParser.html_tpls[i]);}
return str;};bbcodeParser.htmlToBBCode=function(str){var i=0;for(;i<bbcodeParser.html_matches.length;i+=1){str=str.replace(bbcodeParser.html_matches[i],bbcodeParser.bbcode_tpls[i]);}
return str;}
function preg_quote(str,delimiter){return(str+'').replace(new RegExp('[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\'+(delimiter||'')+'-]','g'),'\\$&');}
bbcodeParser.addBBCode('[text]{TEXT}[/text]','<span>{TEXT}</span>');bbcodeParser.addBBCode('[simpletext]{SIMPLETEXT}[/simpletext]','<span>{SIMPLETEXT}</span>');bbcodeParser.addBBCode('[inttext]{INTTEXT}[/inttext]','<span>{INTTEXT}</span>');bbcodeParser.addBBCode('[identifier]{IDENTIFIER}[/identifier]','<span>{IDENTIFIER}</span>');bbcodeParser.addBBCode('[color]{COLOR}[/color]','<span>{COLOR}</span>');bbcodeParser.addBBCode('[number]{NUMBER}[/number]','<span>{NUMBER}</span>');bbcodeParser.addBBCode('[url]{URL}[/url]','<span>{URL}</span>');bbcodeParser.addBBCode('[b]{TEXT}[/b]','<strong>{TEXT}</strong>');bbcodeParser.addBBCode('[i]{TEXT}[/i]','<em>{TEXT}</em>');bbcodeParser.addBBCode('[color={COLOR}]{TEXT}[/color]','<span style="color:{COLOR}">{TEXT}</span>');bbcodeParser.addBBCode('[color={COLOR}]{TEXT}[/color]','<span style="color: {COLOR}">{TEXT}</span>');bbcodeParser.addBBCode('[highlight={COLOR}]{TEXT}[/highlight]','<span style="background-color: {COLOR}">{TEXT}</span>');bbcodeParser.addBBCode('[url]{URL}[/url]','<a href="{URL}">{URL}</a>');bbcodeParser.addBBCode('[quote="{TEXT1}"]{TEXT2}[/quote]','<div class="quote"><cite>{TEXT1}</cite><p>{TEXT2}</p></div>');bbcodeParser.addBBCode('[url={URL}]{TEXT}[/url]','<a href="{URL}">{TEXT}</a>');bbcodeParser.addBBCode('[quote={TEXT1}]{TEXT2}[/quote]','<div class="quote"><cite>{TEXT1}</cite><p>{TEXT2}</p></div>');bbcodeParser.addBBCode('{TEXT}\n','<p>{TEXT}</p>');})();